<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Content Booster</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>YouTube 컨텐츠 부스터</h1>
    <p>키워드를 입력하여 최신 트렌드 영상을 확인하세요.</p>
    <input type="text" id="searchInput" placeholder="검색어를 입력하세요">
    
    <!-- 체크박스 추가 -->
    <label>
        <input type="checkbox" id="shortsCheckbox"> SHORTS 영상 포함
    </label>
    
    <button onclick="searchVideos()">검색</button>

    <!-- 결과를 표시할 영역 -->
    <div id="results"></div>

    <script>
        async function searchVideos() {
            const query = document.getElementById('searchInput').value;
            const shortsOnly = document.getElementById('shortsCheckbox').checked;
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            const publishedAfter = oneMonthAgo.toISOString();

            try {
                const response = await fetch(`/.netlify/functions/search?q=${query}&publishedAfter=${publishedAfter}&shortsOnly=${shortsOnly}`);
                const data = await response.json();

                if ((!data.shortsVideos || data.shortsVideos.length === 0) && (!data.regularVideos || data.regularVideos.length === 0)) {
                    console.log('검색 결과가 없습니다.');
                    return;
                }

                // 검색 결과를 표시할 영역 초기화
                const resultsDiv = document.getElementById('results');
                resultsDiv.innerHTML = ''; 

                const videosToDisplay = shortsOnly ? data.shortsVideos : data.regularVideos;

                videosToDisplay.forEach(item => {
                    const thumbnailUrl = item.snippet.thumbnails.default.url;
                    const title = item.snippet.title;
                    const viewCount = item.statistics.viewCount;
                    const publishedAt = new Date(item.snippet.publishedAt).toLocaleDateString();
                    const channelTitle = item.snippet.channelTitle;
                    const videoUrl = `https://www.youtube.com/watch?v=${item.id}`;

                    const videoElement = `
                        <div>
                            <img src="${thumbnailUrl}" alt="Thumbnail">
                            <a href="${videoUrl}" target="_blank">${title}</a>
                            <p>${viewCount} views - ${publishedAt} - ${channelTitle}</p>
                        </div>
                    `;
                    resultsDiv.innerHTML += videoElement;
                });

            } catch (error) {
                console.error('검색 중 오류 발생:', error);
            }
        }
    </script>
</body>
</html>
